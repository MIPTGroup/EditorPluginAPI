Обьявления функций и структур есть в приложенном файле.

1. Загрузка плагина

Для того, чтобы начать работу с плагином, редактор загружает разделяемую библиотеку с ним и вызывает функцию getPluginInterface, которая возвращает структуру PluginInterface c указателями на функции. Посредством функции getInfo программа может узнать информацию о плагине и его тип (инструмент или эффект). Инструмент отличается от эффекта тем, что в инструмент передается состояние/позиция мыши, а эффект можно только применить ко всему слою/изображению.

2. Инициализация плагина

Для работы плагина программа обязана вызвать функцию passRenderer и передать заполненную структуру с методами, посредством которых плагин может рисовать на заданном таргете. Таргет - произвольный хендл (void*), определяемый программой и позволяющий ей определить, относительно чего была вызвана функция рисования.

3. Работа плагина

Для инструмента - программа дергает методы onTargetMouseClick/Move/Release, уведомляя плагин о состоянии мыши. В метод передается таргет - где плагин должен рисовать в ответ на событие (подразумевается, что плагин не должен манипулировать слоями и рисовать там, где ему говорит программа, собственно, передавая разные таргеты, приложение может обеспечивать работу плагина на разных слоях). Посредством методов onSizeChange и onColorChange приложение уведомляет плагин об изменении глобальных параметров цвета и размера кисти.

Для эффекта - приложение вызывает targetApply, в ответ плагин применяет эффект на переданный таргет.
